# ملاحظات لمدير النظام

## إصلاح مشكلة عدم ظهور الاشتراكات في لوحة الأدمن

قمنا بإجراء التعديلات التالية لحل مشكلة عدم ظهور طلبات الاشتراك في صفحة إدارة الاشتراكات:

### 1. تعديل ملف `app/api/payment-request/route.ts`

- تحسين سجلات التتبع لتسهيل التشخيص
- إضافة التحقق من وجود جدول الاشتراكات وإنشائه إذا لم يكن موجودًا
- محاولة إدخال السجلات بطرق متعددة للتغلب على أخطاء الاتصال
- إضافة سجل تشخيصي للبيانات التي يتم إدخالها

### 2. إنشاء ملف `FIX_PAYMENTS_AND_SUBSCRIPTIONS.sql`

هذا الملف SQL يقوم بعدة مهام:
- إنشاء جدول الدفعات والاشتراكات إن لم يكن موجودًا
- إضافة الفهارس اللازمة لتحسين الأداء
- نقل البيانات من جدول `payments` إلى جدول `subscriptions`
- إنشاء سجلات اشتراك للمستخدمين الذين لديهم إيصالات دفع ولكن لا يوجد لهم اشتراكات
- تحديث حالة اشتراك المستخدمين حسب حالة اشتراكاتهم

## كيفية الاستخدام:

### 1. قم بتنفيذ السكربت SQL:
- افتح SQL Editor في لوحة تحكم Supabase
- انسخ محتوى ملف `FIX_PAYMENTS_AND_SUBSCRIPTIONS.sql` وقم بتنفيذه
- تحقق من النتائج المعروضة للتأكد من نجاح العملية

### 2. اختبر النظام:
- قم بتسجيل الدخول كأدمن
- انتقل إلى قسم إدارة الاشتراكات
- يجب أن ترى الآن قائمة بجميع طلبات الاشتراك
- استخدم عامل التصفية لعرض الطلبات حسب الحالة (معلق، نشط، ملغي)

## ملاحظات إضافية:

- **صيانة دورية**: قم بتشغيل السكربت كل فترة للتأكد من تزامن جداول الدفع والاشتراكات
- **التحقق من الأخطاء**: تحقق من سجلات التطبيق عند استلام إيصالات دفع جديدة
- **المستخدمون المعلقون**: تأكد من مراجعة قسم "معلق" بانتظام للموافقة على الاشتراكات الجديدة

## تحديث الإصدارات المستقبلية:

سيتم في التحديثات المستقبلية:
- تحسين تنبيهات الأدمن عند استلام طلبات اشتراك جديدة
- إضافة لوحة تحكم للإحصائيات تعرض معدلات التحويل ونمو الاشتراكات
- إضافة وظيفة الدفع التلقائي والتجديد التلقائي
