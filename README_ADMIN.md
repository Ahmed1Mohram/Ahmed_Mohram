# دليل المدير لإدارة الاشتراكات

## ملخص التعديلات التي تمت

قمنا بعدة تعديلات لإصلاح نظام الاشتراكات وإدارتها، وتشمل:

1. **إصلاح بنية قاعدة البيانات**
   - إضافة الأعمدة المفقودة في جدول المستخدمين
   - تصحيح بنية جدول الاشتراكات
   - إضافة الفهارس اللازمة لتحسين الأداء

2. **تحسين واجهة إدارة الاشتراكات**
   - إضافة عرض إيصالات الدفع في صفحة الاشتراكات
   - تحسين عرض بيانات المستخدمين المرتبطة بالاشتراكات
   - إضافة وظائف لتفعيل وإنهاء الاشتراكات

3. **تحسين تكامل البيانات**
   - ربط الدفعات بالاشتراكات
   - تحديث حالة اشتراك المستخدمين تلقائيًا

## كيفية الاستخدام

### 1. تهيئة قاعدة البيانات

1. افتح لوحة تحكم Supabase
2. انتقل إلى SQL Editor
3. قم بتنفيذ السكريبت `FINAL_FIX_SUBSCRIPTIONS.sql`

### 2. إدارة الاشتراكات

بعد تسجيل الدخول كمدير، يمكنك:

- **عرض جميع الاشتراكات**: انتقل إلى صفحة إدارة الاشتراكات
- **تصفية الاشتراكات**: استخدم الفلاتر لعرض الاشتراكات حسب الحالة (نشط، معلق، منتهي)
- **عرض إيصالات الدفع**: اضغط على زر "عرض الإيصال" في قائمة الإجراءات لكل اشتراك
- **تفعيل الاشتراكات**: استخدم زر "تفعيل الاشتراك" للاشتراكات المعلقة بعد التحقق من إيصال الدفع
- **إنهاء الاشتراكات**: استخدم زر "إنهاء الاشتراك" لإلغاء اشتراك نشط

### 3. دورة حياة الاشتراكات

1. **إنشاء الاشتراك**:
   - يقوم المستخدم بإنشاء حساب
   - يختار باقة ويقوم بالدفع
   - يرسل إيصال الدفع
   - يظهر الاشتراك في لوحة الإدارة بحالة "معلق"

2. **تفعيل الاشتراك**:
   - يتحقق المدير من إيصال الدفع
   - يقوم بتفعيل الاشتراك
   - تتغير حالة اشتراك المستخدم إلى "نشط"
   - يتمكن المستخدم من الوصول إلى المحتوى

3. **انتهاء الاشتراك**:
   - ينتهي الاشتراك تلقائيًا بعد انتهاء المدة
   - أو يقوم المدير بإنهائه يدويًا
   - تتغير حالة اشتراك المستخدم إلى "غير نشط"

## نصائح للإدارة

1. **تحقق من الاشتراكات المعلقة بانتظام** لتفعيلها بعد التحقق من الدفع
2. **استخدم الفلاتر** لتركيز عملك على الاشتراكات التي تحتاج إلى إجراء
3. **تحقق من إيصالات الدفع** للتأكد من صحة المعاملة قبل تفعيل الاشتراكات

## استكشاف الأخطاء وإصلاحها

إذا واجهت مشكلات في نظام الاشتراكات:

1. تأكد من تنفيذ السكريبت `FINAL_FIX_SUBSCRIPTIONS.sql` لإصلاح بنية قاعدة البيانات
2. تحقق من سجلات الخطأ في وحدة تحكم المتصفح
3. تأكد من إعادة تشغيل التطبيق بعد أي تغييرات في قاعدة البيانات
